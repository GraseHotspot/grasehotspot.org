{"componentChunkName":"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js","path":"/documentation/iptables-rules","result":{"data":{"mdx":{"id":"96903a1c-23e3-5631-a731-20db3bb9f69f","excerpt":"Transparent Proxy In older versions of CoovaChilli we used the following firewall rules in ipup.sh for transparent squid proxy These allowed us to block directâ€¦","fields":{"slug":"/documentation/iptables-rules/"},"frontmatter":{"title":"Iptables rules","description":null,"image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Iptables rules\",\n  \"date\": \"2011-04-02T13:34:28+10:00\",\n  \"status\": \"publish\",\n  \"permalink\": \"/documentation/iptables-rules\",\n  \"author\": \"tim\",\n  \"excerpt\": \"\",\n  \"type\": \"page\",\n  \"id\": 41\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"transparent-proxy\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#transparent-proxy\",\n    \"aria-label\": \"transparent proxy permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Transparent Proxy\"), mdx(\"p\", null, \"In older versions of CoovaChilli we used the following firewall rules in ipup.sh for transparent squid proxy\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"# TRANS PROXY\\n   ipt -I PREROUTING -t nat -p tcp -s 10.1.0.0/24 -d 10.1.0.1 --dport 3128 -j DROP\\n   ipt -I PREROUTING -t nat -i $IF -p tcp -s 10.1.0.0/24 -d\\xA0! 10.1.0.1 --dport 80 -j REDIRECT --to 3128\\n\")), mdx(\"p\", null, \"These allowed us to block direct access to the squid proxy (seeing as you needed to add 3128 as an allowed port in the chilli config file) which would bypass authentication, but would transparently redirect website requests to the proxy (which occured after authentication). It just worked. However, a newer version of netfilter (iptables) prevents the DROP target being applied in the nat table, as nat is for nat not filtering. (Also, newer CoovaChilli versions replace $IF with something else).\"), mdx(\"p\", null, \"This has lead to the new rules looking like this.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"# TRANS PROXY\\n   ipt -I PREROUTING -t mangle -p tcp -s 10.1.0.0/24 -d 10.1.0.1 --dport 3128 -j DROP\\n   ipt -I PREROUTING -t nat -i $TUNTAP -p tcp -s 10.1.0.0/24 -d\\xA0! 10.1.0.1 --dport 80 -j REDIRECT --to 3128\\n\")), mdx(\"p\", null, \"DROP rule needs to be in mangle, not nat. $IF becomes $TUNTAP.\"), mdx(\"p\", null, \"You don't need to add these rules in to the GRASE Hotspot package as they have already been done, hopefully this will be useful to someone else trying to get transparent proxy working with Coova Chilli.\"), mdx(\"p\", null, \"(To assist search engines. The errors you may encounter with the old rules are as follows.)\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"The \\\"nat\\\" table is not intended for filtering, the use of DROP is therefore inhibited.\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"The \\\"nat\\\" table is not intended for filtering, hence the use of DROP is deprecated and will permanently be disabled in the next iptables release.\"), \" Please adjust your scripts\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Transparent Proxy"}]}},"pageContext":{"slug":"/documentation/iptables-rules/","next":{"label":"About","link":"/about"},"repositoryEditUrl":"https://github.com/GraseHotspot/grasehotspot.org/tree/main/src/docs/documentation/iptables-rules.md","repositoryProvider":"GitHub"}},"staticQueryHashes":["1954253342","2328931024","2501019404","973074209"]}